name: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è YML-—Ñ–∏–¥–∞

on:
  schedule:
    - cron: '0 21 * * *'  # –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 00:00 –ú–°–ö
  workflow_dispatch:     # –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –≤—Ä—É—á–Ω—É—é

jobs:
  generate-feed:
    runs-on: ubuntu-latest

    steps:
      - name: üì• –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
        uses: actions/checkout@v4

      - name: üêç –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: üì¶ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
        run: |
          pip install requests beautifulsoup4 lxml

      - name: üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç
        run: |
          python feed.py

      - name: üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —Å–æ–∑–¥–∞–Ω –ª–∏ —Ñ–∏–¥
        run: |
          if [ -f "sushi_street_catalog.xml" ]; then
            echo "‚úÖ –§–∏–¥ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω: $(ls -la sushi_street_catalog.xml)"
            echo "–†–∞–∑–º–µ—Ä: $(wc -c < sushi_street_catalog.xml) –±–∞–π—Ç"
          else
            echo "‚ùå –û—à–∏–±–∫–∞: —Ñ–∏–¥ –Ω–µ —Å–æ–∑–¥–∞–Ω"
            ls -la  # –ü–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ –µ—Å—Ç—å –≤ –ø–∞–ø–∫–µ
            exit 1
          fi

      - name: üì§ –û–±–Ω–æ–≤–∏—Ç—å —Ñ–∏–¥ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          
          if git diff --quiet sushi_street_catalog.xml; then
            echo "‚ÑπÔ∏è –§–∏–¥ –Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è ‚Äî –∫–æ–º–º–∏—Ç –Ω–µ –Ω—É–∂–µ–Ω"
          else
            git add sushi_street_catalog.xml
            git commit -m "–û–±–Ω–æ–≤–ª–µ–Ω —Ñ–∏–¥: $(date)"
            git push
            echo "‚úÖ –§–∏–¥ –æ–±–Ω–æ–≤–ª—ë–Ω –∏ –∑–∞–≥—Ä—É–∂–µ–Ω"
          fi
